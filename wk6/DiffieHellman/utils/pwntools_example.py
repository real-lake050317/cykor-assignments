#!/usr/bin/env python3

from pwn import *
import json

# https://cryptohack.org/challenges/introduction/   Network Attacks

p = 2410312426921032588552076022197566074856950548502459942654116941958108831682612228890093858261341614673227141477904012196503648957050582631942730706805009223062734745341073406696246014589361659774041027169249453200378729434170325843778659198143763193776859869524088940195577346119843545301547043747207749969763750084308926339295559968882457872412993810129130294592999947926365264059284647209730384947211681434464714438488520940127459844288859336526896320919633919
g = 2
A = 1241972460522075344783337556660700537760331108332735677863862813666578639518899293226399921252049655031563612905395145236854443334774555982204857895716383215705498970395379526698761468932147200650513626028263449605755661189525521343142979265044068409405667549241125597387173006460145379759986272191990675988873894208956851773331039747840312455221354589910726982819203421992729738296452820365553759182547255998984882158393688119629609067647494762616719047466973581

def call(port: int, req: dict):
    HOST = "socket.cryptohack.org"
    PORT = port

    r = remote(HOST, PORT)

    def json_recv():
        line = r.readline()
        return json.loads(line.decode())

    def json_send(hsh):
        request = json.dumps(hsh).encode()
        r.sendline(request)

    print(r.recvline())
    print(r.readline())
    print(r.recv(2))
    print(r.recvuntil(b'ok.\n'))
    r.recvline()

    # request = {"buy" : "clothes"}
    json_send(req)

    response = json_recv()
    print(response)
    print(response['error'])
    
if __name__ == "__main__":
    data2={"p": p, "g": g, "A": hex(A)}

    request = json.dumps(data2).encode()
    call(13371, request)